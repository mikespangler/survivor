generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(uuid())
  clerkId        String   @unique
  email          String?  @unique
  name           String?
  systemRole     String   @default("user")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  ownedLeagues   League[]
  teams          Team[]
  memberLeagues  League[] @relation("LeagueMembers")

  @@index([clerkId])
}

model League {
  id            String         @id @default(cuid())
  name          String
  description   String?
  ownerId       String
  createdAt     DateTime       @default(now())
  owner         User           @relation(fields: [ownerId], references: [id])
  leagueSeasons LeagueSeason[]
  members       User[]         @relation("LeagueMembers")
}

model LeagueSeason {
  id           String                @id @default(cuid())
  leagueId     String
  seasonId     String
  draftConfigs DraftConfig[]
  league       League                @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  season       Season                @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  settings     LeagueSeasonSettings?
  teams        Team[]

  @@unique([leagueId, seasonId])
}

model Team {
  id             String         @id @default(cuid())
  name           String
  leagueSeasonId String
  ownerId        String
  totalPoints    Int            @default(0)
  leagueSeason   LeagueSeason   @relation(fields: [leagueSeasonId], references: [id], onDelete: Cascade)
  owner          User           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  roster         TeamCastaway[]
}

model Season {
  id            String         @id @default(cuid())
  number        Int            @unique
  name          String
  status        String
  startDate     DateTime?
  activeEpisode Int            @default(1)
  castaways     Castaway[]
  episodes      Episode[]
  leagueSeasons LeagueSeason[]
}

model Castaway {
  id       String         @id @default(cuid())
  name     String
  seasonId String
  status   String
  season   Season         @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  teams    TeamCastaway[]
}

model TeamCastaway {
  id           String   @id @default(cuid())
  teamId       String
  castawayId   String
  startEpisode Int
  endEpisode   Int?
  castaway     Castaway @relation(fields: [castawayId], references: [id], onDelete: Cascade)
  team         Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, castawayId, startEpisode])
}

model Episode {
  id       String    @id @default(cuid())
  seasonId String
  number   Int
  airDate  DateTime?
  title    String?
  season   Season    @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@unique([seasonId, number])
}

model LeagueSeasonSettings {
  id             String       @id @default(cuid())
  leagueSeasonId String       @unique
  settings       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  leagueSeason   LeagueSeason @relation(fields: [leagueSeasonId], references: [id], onDelete: Cascade)
}

model DraftConfig {
  id               String       @id @default(cuid())
  leagueSeasonId   String
  roundNumber      Int          @default(1)
  castawaysPerTeam Int
  draftDate        DateTime?
  status           String       @default("PENDING")
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  leagueSeason     LeagueSeason @relation(fields: [leagueSeasonId], references: [id], onDelete: Cascade)

  @@unique([leagueSeasonId, roundNumber])
  @@index([leagueSeasonId])
}
